<!DOCTYPE html>
<html lang="id" class="dark-mode">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <meta name="description" content="Sistem Manajemen Pendidikan Hybrid SAIFUSKI V6.0 - Platform produktivitas terintegrasi">
    <meta name="theme-color" content="#000000">
    <title>SAIFUSKI | Command Center V6.0</title>
    <link rel="manifest" href="/manifest.json">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* === VARIABLES & RESET === */
        :root {
            --bg-primary: #000000;
            --bg-secondary: #0a0a0a;
            --bg-tertiary: #111111;
            --accent-primary: #ffffff;
            --accent-secondary: #0a84ff;
            --accent-success: #32d74b;
            --accent-danger: #ff453a;
            --accent-warning: #ffd60a;
            --border-primary: #1c1c1e;
            --border-secondary: #2c2c2e;
            --text-primary: #ffffff;
            --text-secondary: #8e8e93;
            --text-tertiary: #636366;
            --overlay: rgba(0,0,0,0.8);
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 24px;
            --transition-fast: 0.15s ease;
            --transition-normal: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: 0.5s ease;
            --gradient-primary: linear-gradient(135deg, #0a84ff 0%, #5e5ce6 100%);
            --gradient-dark: linear-gradient(135deg, #000000 0%, #1c1c1e 100%);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        :focus-visible {
            outline: 2px solid var(--accent-secondary);
            outline-offset: 2px;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            background-color: var(--bg-primary);
            color: var(--text-primary);
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* === UTILITY CLASSES === */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        .loading {
            position: relative;
            overflow: hidden;
        }

        .loading::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.05), transparent);
            animation: shimmer 1.5s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* === LAYOUT === */
        .container {
            max-width: 1400px;
            width: 100%;
            display: grid;
            grid-template-columns: minmax(300px, 1fr) minmax(400px, 2fr) minmax(300px, 1fr);
            gap: 24px;
            align-items: start;
        }

        header {
            grid-column: 1 / -1;
            border-bottom: 1px solid var(--border-primary);
            padding-bottom: 24px;
            margin-bottom: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        /* === COMPONENTS === */
        .card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-primary);
            border-radius: var(--radius-lg);
            padding: 24px;
            margin-bottom: 24px;
            transition: var(--transition-normal);
            position: relative;
            overflow: hidden;
        }

        .card:hover {
            border-color: var(--border-secondary);
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .section-title {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            color: var(--text-secondary);
            letter-spacing: 1.5px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title i {
            font-size: 0.9rem;
        }

        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.65rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .badge-success {
            background-color: rgba(50, 215, 75, 0.15);
            color: var(--accent-success);
        }

        .badge-warning {
            background-color: rgba(255, 214, 10, 0.15);
            color: var(--accent-warning);
        }

        .badge-danger {
            background-color: rgba(255, 69, 58, 0.15);
            color: var(--accent-danger);
        }

        .badge-info {
            background-color: rgba(10, 132, 255, 0.15);
            color: var(--accent-secondary);
        }

        /* === HEADER & BRAND === */
        .brand {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .brand h1 {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 2.5rem;
            font-weight: 800;
            margin: 0;
            letter-spacing: -1.5px;
            text-transform: uppercase;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .brand-subtitle {
            font-size: 0.7rem;
            letter-spacing: 2.5px;
            color: var(--text-secondary);
            font-weight: 600;
        }

        .system-status {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.75rem;
            font-weight: 700;
            padding: 8px 16px;
            border-radius: 20px;
            background: rgba(50, 215, 75, 0.1);
            color: var(--accent-success);
            border: 1px solid rgba(50, 215, 75, 0.3);
        }

        .status-indicator::before {
            content: '';
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: var(--accent-success);
            display: block;
            animation: pulse 2s infinite;
        }

        .theme-toggle {
            background: transparent;
            border: 1px solid var(--border-primary);
            color: var(--text-primary);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition-normal);
        }

        .theme-toggle:hover {
            background: var(--bg-tertiary);
            border-color: var(--border-secondary);
        }

        /* === CAMERA SYSTEM === */
        #camera-preview {
            width: 100%;
            height: 200px;
            border-radius: var(--radius-md);
            background: #000;
            object-fit: cover;
            margin-bottom: 16px;
            border: 1px solid var(--border-primary);
            display: none;
        }

        .camera-controls {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .camera-controls button {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            padding: 12px;
            border-radius: var(--radius-md);
            border: 1px solid var(--border-primary);
            background: var(--bg-tertiary);
            color: var(--text-primary);
            cursor: pointer;
            transition: var(--transition-normal);
            font-size: 0.7rem;
        }

        .camera-controls button:hover {
            background: var(--border-primary);
            border-color: var(--border-secondary);
        }

        .camera-controls button i {
            font-size: 1.2rem;
        }

        /* === FORM CONTROLS === */
        .input-group {
            margin-bottom: 16px;
        }

        .input-label {
            display: block;
            font-size: 0.75rem;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-secondary);
        }

        input, select, textarea {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-primary);
            color: var(--text-primary);
            padding: 14px 16px;
            border-radius: var(--radius-md);
            font-size: 0.85rem;
            width: 100%;
            outline: none;
            transition: var(--transition-normal);
            font-family: 'Inter', sans-serif;
        }

        input:focus, select:focus, textarea:focus {
            border-color: var(--accent-secondary);
            box-shadow: 0 0 0 3px rgba(10, 132, 255, 0.1);
        }

        input::placeholder, textarea::placeholder {
            color: var(--text-tertiary);
        }

        .btn {
            background: var(--gradient-primary);
            color: white;
            border: none;
            padding: 16px;
            border-radius: var(--radius-md);
            font-weight: 700;
            cursor: pointer;
            text-transform: uppercase;
            font-size: 0.75rem;
            letter-spacing: 0.5px;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: var(--transition-normal);
            position: relative;
            overflow: hidden;
        }

        .btn::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: var(--transition-slow);
        }

        .btn:hover::after {
            left: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(10, 132, 255, 0.2);
        }

        .btn-secondary {
            background: transparent;
            border: 1px solid var(--border-primary);
            color: var(--text-primary);
        }

        .btn-secondary:hover {
            background: var(--bg-tertiary);
            border-color: var(--border-secondary);
            box-shadow: none;
        }

        .btn-danger {
            background: var(--accent-danger);
        }

        .btn-danger:hover {
            box-shadow: 0 10px 20px rgba(255, 69, 58, 0.2);
        }

        /* === NOTES GRID === */
        #notesContainer {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .note-card {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-primary);
            border-radius: var(--radius-md);
            overflow: hidden;
            transition: var(--transition-normal);
            position: relative;
            animation: fadeIn 0.5s ease-out;
        }

        .note-card:hover {
            transform: translateY(-4px);
            border-color: var(--border-secondary);
            box-shadow: var(--shadow);
        }

        .note-card-header {
            padding: 16px 16px 12px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .note-card-category {
            font-size: 0.65rem;
            font-weight: 700;
            padding: 4px 10px;
            border-radius: 4px;
            background: var(--accent-secondary);
            color: white;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .note-card-actions {
            display: flex;
            gap: 8px;
        }

        .note-card-action {
            background: transparent;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            width: 28px;
            height: 28px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition-fast);
        }

        .note-card-action:hover {
            background: rgba(255,255,255,0.05);
            color: var(--text-primary);
        }

        .note-img {
            width: 100%;
            height: 160px;
            object-fit: cover;
            background: #000;
            display: block;
        }

        .note-content {
            padding: 0 16px 16px;
        }

        .note-title {
            font-weight: 700;
            font-size: 0.95rem;
            margin-bottom: 8px;
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .note-meta {
            display: flex;
            justify-content: space-between;
            font-size: 0.7rem;
            color: var(--text-tertiary);
            margin-top: 12px;
        }

        .empty-state {
            grid-column: 1 / -1;
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .empty-state h3 {
            font-size: 1.2rem;
            margin-bottom: 10px;
            color: var(--text-primary);
        }

        /* === TIME DISPLAY === */
        .time-display {
            font-family: 'Space Grotesk', monospace;
            font-size: 3rem;
            font-weight: 800;
            text-align: center;
            letter-spacing: -1px;
            margin-bottom: 8px;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .date-display {
            text-align: center;
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: 20px;
        }

        .world-clocks {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 20px;
        }

        .world-clock {
            background: var(--bg-tertiary);
            padding: 12px;
            border-radius: var(--radius-sm);
            text-align: center;
        }

        .world-clock-city {
            font-size: 0.65rem;
            color: var(--text-tertiary);
            margin-bottom: 4px;
        }

        .world-clock-time {
            font-family: 'Space Grotesk', monospace;
            font-size: 0.9rem;
            font-weight: 600;
        }

        /* === CALCULATOR === */
        .calculator {
            background: var(--bg-tertiary);
            border-radius: var(--radius-md);
            overflow: hidden;
            border: 1px solid var(--border-primary);
        }

        #calcDisplay {
            background: transparent;
            border: none;
            color: white;
            text-align: right;
            font-size: 1.8rem;
            font-family: 'Space Grotesk', monospace;
            padding: 20px;
            width: 100%;
            border-bottom: 1px solid var(--border-primary);
        }

        .calc-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1px;
            background: var(--border-primary);
        }

        .calc-grid button {
            padding: 20px;
            border: none;
            background: var(--bg-secondary);
            color: white;
            cursor: pointer;
            font-size: 1.1rem;
            font-family: 'Space Grotesk', monospace;
            transition: var(--transition-fast);
        }

        .calc-grid button:hover {
            background: var(--bg-tertiary);
        }

        .calc-grid button.operator {
            background: var(--accent-secondary);
            color: white;
        }

        .calc-grid button.equals {
            background: var(--accent-success);
            color: white;
        }

        .calc-grid button.clear {
            background: var(--accent-danger);
            color: white;
        }

        /* === MODAL & OVERLAY === */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--overlay);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition-normal);
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: var(--bg-secondary);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-primary);
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            transform: translateY(20px);
            transition: var(--transition-normal);
        }

        .modal-overlay.active .modal {
            transform: translateY(0);
        }

        .modal-header {
            padding: 24px;
            border-bottom: 1px solid var(--border-primary);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.2rem;
            font-weight: 700;
        }

        .modal-close {
            background: transparent;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition-fast);
        }

        .modal-close:hover {
            background: rgba(255,255,255,0.05);
            color: var(--text-primary);
        }

        .modal-body {
            padding: 24px;
        }

        .modal-footer {
            padding: 20px 24px;
            border-top: 1px solid var(--border-primary);
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        /* === TOAST NOTIFICATIONS === */
        .toast-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1001;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .toast {
            background: var(--bg-secondary);
            border: 1px solid var(--border-primary);
            border-radius: var(--radius-md);
            padding: 16px;
            min-width: 300px;
            display: flex;
            align-items: flex-start;
            gap: 12px;
            box-shadow: var(--shadow);
            transform: translateX(100%);
            opacity: 0;
            transition: var(--transition-normal);
        }

        .toast.show {
            transform: translateX(0);
            opacity: 1;
        }

        .toast-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .toast-success .toast-icon {
            background: rgba(50, 215, 75, 0.15);
            color: var(--accent-success);
        }

        .toast-error .toast-icon {
            background: rgba(255, 69, 58, 0.15);
            color: var(--accent-danger);
        }

        .toast-warning .toast-icon {
            background: rgba(255, 214, 10, 0.15);
            color: var(--accent-warning);
        }

        .toast-info .toast-icon {
            background: rgba(10, 132, 255, 0.15);
            color: var(--accent-secondary);
        }

        .toast-content {
            flex: 1;
        }

        .toast-title {
            font-weight: 700;
            font-size: 0.9rem;
            margin-bottom: 4px;
        }

        .toast-message {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .toast-close {
            background: transparent;
            border: none;
            color: var(--text-tertiary);
            cursor: pointer;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        /* === RESPONSIVE DESIGN === */
        @media (max-width: 1200px) {
            .container {
                grid-template-columns: 1fr 1fr;
            }
            
            header {
                grid-column: span 2;
            }
            
            main {
                grid-column: span 2;
            }
        }

        @media (max-width: 768px) {
            body {
                padding: 16px;
            }
            
            .container {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            header {
                grid-column: span 1;
                flex-direction: column;
                align-items: flex-start;
            }
            
            .system-status {
                width: 100%;
                justify-content: space-between;
            }
            
            .time-display {
                font-size: 2.5rem;
            }
            
            #notesContainer {
                grid-template-columns: 1fr;
            }
            
            .camera-controls {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 480px) {
            .brand h1 {
                font-size: 2rem;
            }
            
            .time-display {
                font-size: 2rem;
            }
            
            .calc-grid button {
                padding: 16px;
            }
            
            .modal {
                width: 95%;
            }
        }

        /* === PRINT STYLES === */
        @media print {
            .no-print {
                display: none !important;
            }
            
            .card {
                border: 1px solid #ddd;
                break-inside: avoid;
            }
            
            body {
                background: white;
                color: black;
            }
        }

        /* === DARK/LIGHT THEME === */
        .light-mode {
            --bg-primary: #f5f5f7;
            --bg-secondary: #ffffff;
            --bg-tertiary: #f2f2f7;
            --accent-primary: #000000;
            --accent-secondary: #007aff;
            --accent-success: #34c759;
            --accent-danger: #ff3b30;
            --accent-warning: #ffcc00;
            --border-primary: #c7c7cc;
            --border-secondary: #d1d1d6;
            --text-primary: #000000;
            --text-secondary: #6c6c70;
            --text-tertiary: #8e8e93;
            --overlay: rgba(0,0,0,0.4);
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            --gradient-primary: linear-gradient(135deg, #007aff 0%, #5856d6 100%);
            --gradient-dark: linear-gradient(135deg, #f5f5f7 0%, #e5e5ea 100%);
        }
    </style>
</head>
<body>

<div class="container">
    <!-- HEADER -->
    <header>
        <div class="brand">
            <h1>SAIFUSKI<span style="-webkit-text-fill-color: var(--text-primary);">.</span></h1>
            <div class="brand-subtitle">V6.0 HYBRID EDUCATION SYSTEM</div>
        </div>
        
        <div class="system-status">
            <div class="status-indicator" id="syncStatus">
                <span>CLOUD ACTIVE</span>
            </div>
            <button class="theme-toggle" id="themeToggle" aria-label="Toggle theme">
                <i class="fas fa-moon"></i>
            </button>
            <button class="btn-secondary" onclick="showSettingsModal()" style="width: auto; padding: 8px 16px;">
                <i class="fas fa-cog"></i>
            </button>
        </div>
    </header>

    <!-- LEFT SIDEBAR -->
    <aside>
        <!-- SCHEDULE -->
        <div class="card">
            <div class="card-header">
                <h2 class="section-title"><i class="fas fa-calendar-alt"></i> 01 — STRATEGIC SCHEDULE</h2>
                <button class="btn-secondary" onclick="refreshSchedule()" style="width: auto; padding: 4px 12px; font-size: 0.7rem;">Refresh</button>
            </div>
            <img src="https://i.ibb.co.com/cX8Kmr68/IMG-20250109-WA0004.jpg" alt="Jadwal Akademik" style="width: 100%; border-radius: var(--radius-md); filter: grayscale(0.8);" loading="lazy">
            <div style="margin-top: 16px;">
                <div class="input-group">
                    <div class="input-label">Prioritas Hari Ini</div>
                    <textarea id="dailyPriority" placeholder="Tulis prioritas utama hari ini..." rows="3" style="resize: vertical;"></textarea>
                </div>
            </div>
        </div>

        <!-- CAPTURE SYSTEM -->
        <div class="card">
            <h2 class="section-title"><i class="fas fa-camera"></i> 02 — CAPTURE & UPLOAD</h2>
            
            <video id="camera-preview" autoplay playsinline aria-label="Kamera preview"></video>
            <canvas id="camera-canvas" style="display:none;"></canvas>
            
            <div class="camera-controls">
                <button onclick="startCamera()" aria-label="Buka kamera">
                    <i class="fas fa-camera"></i>
                    <span>Buka Cam</span>
                </button>
                <button onclick="takePhoto()" aria-label="Ambil foto">
                    <i class="fas fa-circle"></i>
                    <span>Ambil Foto</span>
                </button>
                <button onclick="uploadFile()" aria-label="Unggah file">
                    <i class="fas fa-upload"></i>
                    <span>Unggah File</span>
                </button>
            </div>
            
            <input type="file" id="fileUpload" accept="image/*,.pdf,.doc,.docx,.txt" style="display: none;">
            
            <div class="input-group">
                <div class="input-label">Judul Catatan</div>
                <input type="text" id="noteTitle" placeholder="Judul / Materi..." maxlength="100" required>
            </div>
            
            <div class="input-group">
                <div class="input-label">Deskripsi</div>
                <textarea id="noteDescription" placeholder="Deskripsi tambahan..." rows="2" maxlength="500"></textarea>
            </div>
            
            <div class="input-group">
                <div class="input-label">URL Gambar (opsional)</div>
                <input type="url" id="noteImgUrl" placeholder="https://example.com/image.jpg">
            </div>
            
            <div class="input-group">
                <div class="input-label">Kategori</div>
                <select id="noteCategory">
                    <option value="UMUM">UMUM</option>
                    <option value="TUGAS">TUGAS</option>
                    <option value="MATERI">MATERI KULIAH</option>
                    <option value="RISET">RISET</option>
                    <option value="PRIBADI">PRIBADI</option>
                    <option value="PROYEK">PROYEK</option>
                </select>
            </div>
            
            <div class="input-group">
                <div class="input-label">Prioritas</div>
                <div style="display: flex; gap: 10px;">
                    <button class="btn-secondary" onclick="setPriority('low')" style="flex: 1;">Rendah</button>
                    <button class="btn-secondary" onclick="setPriority('medium')" style="flex: 1;">Sedang</button>
                    <button class="btn-secondary" onclick="setPriority('high')" style="flex: 1;">Tinggi</button>
                </div>
            </div>
            
            <button class="btn" onclick="addNote()" id="saveNoteBtn">
                <i class="fas fa-save"></i>
                <span>Simpan Ke Database</span>
            </button>
        </div>
    </aside>

    <!-- MAIN CONTENT -->
    <main>
        <div class="card" style="min-height: 80vh;">
            <div class="card-header">
                <h2 class="section-title"><i class="fas fa-database"></i> 03 — DIGITAL VAULT</h2>
                <div style="display: flex; gap: 10px;">
                    <button class="btn-secondary" onclick="exportData()" style="width: auto; padding: 8px 16px;">
                        <i class="fas fa-download"></i> Ekspor
                    </button>
                    <button class="btn-secondary" onclick="showFilters()" style="width: auto; padding: 8px 16px;">
                        <i class="fas fa-filter"></i> Filter
                    </button>
                </div>
            </div>
            
            <div style="margin-bottom: 20px; display: flex; gap: 10px;">
                <input type="text" id="searchNotes" placeholder="Cari catatan..." style="flex: 1;" oninput="searchNotes()">
                <select id="filterCategory" onchange="filterNotes()" style="width: 150px;">
                    <option value="">Semua Kategori</option>
                    <option value="UMUM">UMUM</option>
                    <option value="TUGAS">TUGAS</option>
                    <option value="MATERI">MATERI KULIAH</option>
                    <option value="RISET">RISET</option>
                </select>
            </div>
            
            <div id="notesContainer">
                <!-- Notes akan ditampilkan di sini -->
                <div class="empty-state">
                    <i class="fas fa-clipboard"></i>
                    <h3>Tidak ada catatan</h3>
                    <p>Mulai dengan menambahkan catatan pertama Anda</p>
                </div>
            </div>
            
            <div style="display: flex; gap: 10px; margin-top: 30px;">
                <button class="btn" onclick="pushToCloud()" id="syncBtn">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <span>SYNC KE CLOUD</span>
                </button>
                <button class="btn btn-secondary" onclick="clearLocalData()" id="clearBtn">
                    <i class="fas fa-trash"></i>
                    <span>Bersihkan Lokal</span>
                </button>
            </div>
        </div>
    </main>

    <!-- RIGHT SIDEBAR -->
    <aside>
        <!-- TIME DISPLAY -->
        <div class="card">
            <h2 class="section-title"><i class="fas fa-clock"></i> 04 — WORLD TIME</h2>
            <div class="time-display" id="clock">00:00:00</div>
            <div class="date-display" id="date">Loading...</div>
            
            <div class="world-clocks">
                <div class="world-clock">
                    <div class="world-clock-city">TOKYO</div>
                    <div class="world-clock-time" id="timeTokyo">--:--</div>
                </div>
                <div class="world-clock">
                    <div class="world-clock-city">LONDON</div>
                    <div class="world-clock-time" id="timeLondon">--:--</div>
                </div>
                <div class="world-clock">
                    <div class="world-clock-city">NEW YORK</div>
                    <div class="world-clock-time" id="timeNewYork">--:--</div>
                </div>
                <div class="world-clock">
                    <div class="world-clock-city">DUBAI</div>
                    <div class="world-clock-time" id="timeDubai">--:--</div>
                </div>
            </div>
        </div>

        <!-- CALCULATOR -->
        <div class="card">
            <h2 class="section-title"><i class="fas fa-calculator"></i> 05 — SCIENTIFIC CALC</h2>
            <div class="calculator">
                <input type="text" id="calcDisplay" value="0" readonly aria-label="Kalkulator display">
                <div class="calc-grid">
                    <button class="clear" onclick="clearCalc()" aria-label="Clear all">AC</button>
                    <button class="operator" onclick="appendCalc('/')" aria-label="Divide">÷</button>
                    <button class="operator" onclick="appendCalc('*')" aria-label="Multiply">×</button>
                    <button class="operator" onclick="appendCalc('-')" aria-label="Subtract">-</button>
                    <button onclick="appendCalc('7')" aria-label="Seven">7</button>
                    <button onclick="appendCalc('8')" aria-label="Eight">8</button>
                    <button onclick="appendCalc('9')" aria-label="Nine">9</button>
                    <button class="operator" onclick="appendCalc('+')" aria-label="Add">+</button>
                    <button onclick="appendCalc('4')" aria-label="Four">4</button>
                    <button onclick="appendCalc('5')" aria-label="Five">5</button>
                    <button onclick="appendCalc('6')" aria-label="Six">6</button>
                    <button class="equals" onclick="execCalc()" aria-label="Equals" style="grid-row: span 2;">=</button>
                    <button onclick="appendCalc('1')" aria-label="One">1</button>
                    <button onclick="appendCalc('2')" aria-label="Two">2</button>
                    <button onclick="appendCalc('3')" aria-label="Three">3</button>
                    <button onclick="appendCalc('0')" aria-label="Zero" style="grid-column: span 2;">0</button>
                    <button onclick="appendCalc('.')" aria-label="Decimal point">.</button>
                </div>
            </div>
        </div>

        <!-- STATISTICS -->
        <div class="card">
            <h2 class="section-title"><i class="fas fa-chart-bar"></i> 06 — STATISTICS</h2>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-top: 16px;">
                <div style="text-align: center;">
                    <div style="font-size: 2rem; font-weight: 800; color: var(--accent-secondary);" id="totalNotes">0</div>
                    <div style="font-size: 0.7rem; color: var(--text-secondary);">Total Catatan</div>
                </div>
                <div style="text-align: center;">
                    <div style="font-size: 2rem; font-weight: 800; color: var(--accent-success);" id="todayNotes">0</div>
                    <div style="font-size: 0.7rem; color: var(--text-secondary);">Hari Ini</div>
                </div>
            </div>
            <div style="margin-top: 20px;">
                <div class="input-label">Penyimpanan Terpakai</div>
                <div style="height: 8px; background: var(--bg-tertiary); border-radius: 4px; overflow: hidden; margin-top: 8px;">
                    <div id="storageBar" style="height: 100%; background: var(--accent-secondary); width: 0%; transition: width 1s ease;"></div>
                </div>
                <div style="display: flex; justify-content: space-between; font-size: 0.7rem; color: var(--text-secondary); margin-top: 4px;">
                    <span id="storageUsed">0 KB</span>
                    <span id="storageTotal">5 MB</span>
                </div>
            </div>
        </div>
    </aside>
</div>

<!-- MODALS -->
<div class="modal-overlay" id="settingsModal">
    <div class="modal">
        <div class="modal-header">
            <div class="modal-title">Pengaturan Sistem</div>
            <button class="modal-close" onclick="hideModal('settingsModal')" aria-label="Close">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body">
            <div class="input-group">
                <div class="input-label">Telegram Bot Token</div>
                <input type="password" id="tgToken" placeholder="Masukkan token bot Telegram">
                <div style="font-size: 0.7rem; color: var(--text-secondary); margin-top: 4px;">
                    Token disimpan secara aman di browser Anda
                </div>
            </div>
            
            <div class="input-group">
                <div class="input-label">Chat ID</div>
                <input type="text" id="tgChatId" placeholder="Masukkan Chat ID">
            </div>
            
            <div class="input-group">
                <div class="input-label">Interval Auto-save (menit)</div>
                <select id="autoSaveInterval">
                    <option value="5">5 menit</option>
                    <option value="10" selected>10 menit</option>
                    <option value="15">15 menit</option>
                    <option value="30">30 menit</option>
                    <option value="60">60 menit</option>
                    <option value="0">Nonaktif</option>
                </select>
            </div>
            
            <div class="input-group">
                <div class="input-label">Notifikasi</div>
                <div style="display: flex; flex-direction: column; gap: 8px;">
                    <label style="display: flex; align-items: center; gap: 8px;">
                        <input type="checkbox" id="notifSound" checked>
                        <span>Suara notifikasi</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px;">
                        <input type="checkbox" id="notifDesktop" checked>
                        <span>Notifikasi desktop</span>
                    </label>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn-secondary" onclick="hideModal('settingsModal')">Batal</button>
            <button class="btn" onclick="saveSettings()">Simpan Pengaturan</button>
        </div>
    </div>
</div>

<!-- EDIT MODAL -->
<div class="modal-overlay" id="editModal">
    <div class="modal">
        <div class="modal-header">
            <div class="modal-title">Edit Catatan</div>
            <button class="modal-close" onclick="hideModal('editModal')" aria-label="Close">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body">
            <input type="hidden" id="editNoteId">
            <div class="input-group">
                <div class="input-label">Judul Catatan</div>
                <input type="text" id="editNoteTitle" placeholder="Judul / Materi...">
            </div>
            <div class="input-group">
                <div class="input-label">Deskripsi</div>
                <textarea id="editNoteDescription" rows="3"></textarea>
            </div>
            <div class="input-group">
                <div class="input-label">Kategori</div>
                <select id="editNoteCategory">
                    <option value="UMUM">UMUM</option>
                    <option value="TUGAS">TUGAS</option>
                    <option value="MATERI">MATERI KULIAH</option>
                    <option value="RISET">RISET</option>
                </select>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn-danger" onclick="deleteNote()">Hapus</button>
            <button class="btn-secondary" onclick="hideModal('editModal')">Batal</button>
            <button class="btn" onclick="saveEditedNote()">Simpan Perubahan</button>
        </div>
    </div>
</div>

<!-- TOAST CONTAINER -->
<div class="toast-container" id="toastContainer"></div>

<script>
    // === INITIALIZATION ===
    class SaifuskiSystem {
        constructor() {
            this.database = [];
            this.settings = {};
            this.videoStream = null;
            this.editIndex = null;
            this.autoSaveInterval = null;
            this.isOnline = navigator.onLine;
            
            this.init();
        }
        
        async init() {
            // Load data
            await this.loadFromLocalStorage();
            await this.loadSettings();
            
            // Initialize components
            this.updateClock();
            setInterval(() => this.updateClock(), 1000);
            this.updateWorldClocks();
            setInterval(() => this.updateWorldClocks(), 30000);
            
            this.renderNotes();
            this.updateStats();
            this.setupEventListeners();
            this.setupAutoSave();
            
            // Check online status
            window.addEventListener('online', () => this.handleOnlineStatus(true));
            window.addEventListener('offline', () => this.handleOnlineStatus(false));
            
            // Service Worker for PWA
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('/sw.js').catch(console.error);
            }
            
            this.showToast('Sistem SAIFUSKI V6.0 dimuat', 'success');
        }
        
        setupEventListeners() {
            // Drag and drop for images
            const dropZone = document.getElementById('noteImgUrl');
            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropZone.style.borderColor = 'var(--accent-secondary)';
            });
            
            dropZone.addEventListener('dragleave', () => {
                dropZone.style.borderColor = 'var(--border-primary)';
            });
            
            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropZone.style.borderColor = 'var(--border-primary)';
                const file = e.dataTransfer.files[0];
                if (file && file.type.startsWith('image/')) {
                    this.readFileAsDataURL(file).then(url => {
                        dropZone.value = url;
                    });
                }
            });
            
            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                if (e.ctrlKey || e.metaKey) {
                    switch(e.key) {
                        case 'n': e.preventDefault(); this.addNote(); break;
                        case 's': e.preventDefault(); this.pushToCloud(); break;
                        case 'f': e.preventDefault(); document.getElementById('searchNotes').focus(); break;
                        case 'e': e.preventDefault(); document.getElementById('editModal').classList.add('active'); break;
                        case 'k': e.preventDefault(); document.getElementById('settingsModal').classList.add('active'); break;
                    }
                }
                
                if (e.key === 'Escape') {
                    this.hideAllModals();
                }
            });
        }
        
        // === CAMERA SYSTEM ===
        async startCamera() {
            const video = document.getElementById('camera-preview');
            try {
                const constraints = {
                    video: {
                        facingMode: "environment",
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    }
                };
                
                this.videoStream = await navigator.mediaDevices.getUserMedia(constraints);
                video.srcObject = this.videoStream;
                video.style.display = "block";
                this.showToast('Kamera diaktifkan', 'success');
            } catch (error) {
                console.error('Camera error:', error);
                this.showToast('Akses kamera ditolak', 'error');
            }
        }
        
        takePhoto() {
            if (!this.videoStream) {
                this.showToast('Aktifkan kamera terlebih dahulu', 'warning');
                return;
            }
            
            const video = document.getElementById('camera-preview');
            const canvas = document.getElementById('camera-canvas');
            
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            
            const ctx = canvas.getContext('2d');
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            
            // Apply image optimization
            const quality = 0.7;
            const dataUrl = canvas.toDataURL('image/jpeg', quality);
            
            document.getElementById('noteImgUrl').value = dataUrl;
            
            // Stop camera
            this.videoStream.getTracks().forEach(track => track.stop());
            video.style.display = "none";
            this.videoStream = null;
            
            this.showToast('Foto berhasil diambil', 'success');
        }
        
        uploadFile() {
            document.getElementById('fileUpload').click();
        }
        
        async handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            if (file.size > 5 * 1024 * 1024) {
                this.showToast('File terlalu besar (max 5MB)', 'error');
                return;
            }
            
            if (file.type.startsWith('image/')) {
                const dataUrl = await this.readFileAsDataURL(file);
                document.getElementById('noteImgUrl').value = dataUrl;
                this.showToast('Gambar berhasil diunggah', 'success');
            } else {
                this.showToast('File berhasil diunggah', 'success');
                // Untuk file non-gambar, simpan sebagai attachment
                this.saveFileAttachment(file);
            }
        }
        
        readFileAsDataURL(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }
        
        // === NOTES MANAGEMENT ===
        addNote() {
            const title = document.getElementById('noteTitle').value.trim();
            const description = document.getElementById('noteDescription').value.trim();
            const img = document.getElementById('noteImgUrl').value.trim();
            const category = document.getElementById('noteCategory').value;
            
            if (!title) {
                this.showToast('Judul catatan tidak boleh kosong', 'warning');
                document.getElementById('noteTitle').focus();
                return;
            }
            
            const note = {
                id: Date.now().toString(36) + Math.random().toString(36).substr(2),
                title,
                description,
                img: img || 'https://images.unsplash.com/photo-1516321318423-f06f85e504b3?w=400&h=200&fit=crop',
                category,
                priority: this.currentPriority || 'medium',
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString(),
                tags: []
            };
            
            this.database.unshift(note);
            this.saveToLocalStorage();
            this.renderNotes();
            this.updateStats();
            this.resetForm();
            
            this.showToast('Catatan berhasil disimpan', 'success');
            
            // Trigger haptic feedback on mobile
            if (window.navigator.vibrate) {
                window.navigator.vibrate(50);
            }
        }
        
        editNote(index) {
            this.editIndex = index;
            const note = this.database[index];
            
            document.getElementById('editNoteId').value = note.id;
            document.getElementById('editNoteTitle').value = note.title;
            document.getElementById('editNoteDescription').value = note.description || '';
            document.getElementById('editNoteCategory').value = note.category;
            
            this.showModal('editModal');
        }
        
        saveEditedNote() {
            if (this.editIndex === null) return;
            
            const title = document.getElementById('editNoteTitle').value.trim();
            if (!title) {
                this.showToast('Judul tidak boleh kosong', 'warning');
                return;
            }
            
            this.database[this.editIndex].title = title;
            this.database[this.editIndex].description = document.getElementById('editNoteDescription').value.trim();
            this.database[this.editIndex].category = document.getElementById('editNoteCategory').value;
            this.database[this.editIndex].updatedAt = new Date().toISOString();
            
            this.saveToLocalStorage();
            this.renderNotes();
            this.hideModal('editModal');
            this.editIndex = null;
            
            this.showToast('Catatan berhasil diperbarui', 'success');
        }
        
        deleteNote() {
            if (this.editIndex === null) return;
            
            if (confirm('Apakah Anda yakin ingin menghapus catatan ini?')) {
                this.database.splice(this.editIndex, 1);
                this.saveToLocalStorage();
                this.renderNotes();
                this.updateStats();
                this.hideModal('editModal');
                this.editIndex = null;
                
                this.showToast('Catatan berhasil dihapus', 'success');
            }
        }
        
        searchNotes() {
            const query = document.getElementById('searchNotes').value.toLowerCase();
            this.renderNotes(query);
        }
        
        filterNotes() {
            const category = document.getElementById('filterCategory').value;
            this.renderNotes('', category);
        }
        
        renderNotes(searchQuery = '', categoryFilter = '') {
            const container = document.getElementById('notesContainer');
            
            let filteredNotes = this.database;
            
            if (searchQuery) {
                filteredNotes = filteredNotes.filter(note => 
                    note.title.toLowerCase().includes(searchQuery) || 
                    (note.description && note.description.toLowerCase().includes(searchQuery))
                );
            }
            
            if (categoryFilter) {
                filteredNotes = filteredNotes.filter(note => note.category === categoryFilter);
            }
            
            if (filteredNotes.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-search"></i>
                        <h3>Tidak ada catatan ditemukan</h3>
                        <p>Coba kata kunci atau filter yang berbeda</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = filteredNotes.map((note, index) => `
                <div class="note-card fade-in">
                    <div class="note-card-header">
                        <span class="note-card-category">${note.category}</span>
                        <div class="note-card-actions">
                            <button class="note-card-action" onclick="system.editNote(${index})" aria-label="Edit catatan">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="note-card-action" onclick="system.shareNote(${index})" aria-label="Bagikan catatan">
                                <i class="fas fa-share"></i>
                            </button>
                        </div>
                    </div>
                    ${note.img ? `<img src="${note.img}" class="note-img" alt="${note.title}" loading="lazy">` : ''}
                    <div class="note-content">
                        <div class="note-title">${this.escapeHtml(note.title)}</div>
                        ${note.description ? `<div style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 8px;">${this.escapeHtml(note.description)}</div>` : ''}
                        <div class="note-meta">
                            <span>${new Date(note.createdAt).toLocaleDateString('id-ID')}</span>
                            <span>${this.getPriorityBadge(note.priority)}</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        // === DATA PERSISTENCE ===
        saveToLocalStorage() {
            try {
                localStorage.setItem('saifuski_database', JSON.stringify(this.database));
                localStorage.setItem('saifuski_settings', JSON.stringify(this.settings));
                this.updateStorageStats();
            } catch (error) {
                console.error('LocalStorage error:', error);
                this.showToast('Gagal menyimpan data lokal', 'error');
            }
        }
        
        async loadFromLocalStorage() {
            try {
                const savedData = localStorage.getItem('saifuski_database');
                if (savedData) {
                    this.database = JSON.parse(savedData);
                }
                
                const savedSettings = localStorage.getItem('saifuski_settings');
                if (savedSettings) {
                    this.settings = JSON.parse(savedSettings);
                }
                
                // Migrate old data if needed
                await this.migrateOldData();
            } catch (error) {
                console.error('Load data error:', error);
                this.database = [];
            }
        }
        
        async loadSettings() {
            // Apply loaded settings to UI
            if (this.settings.tgToken) {
                document.getElementById('tgToken').value = this.settings.tgToken;
            }
            
            if (this.settings.tgChatId) {
                document.getElementById('tgChatId').value = this.settings.tgChatId;
            }
            
            if (this.settings.autoSaveInterval) {
                document.getElementById('autoSaveInterval').value = this.settings.autoSaveInterval;
            }
            
            // Apply theme
            if (this.settings.theme === 'light') {
                document.body.classList.add('light-mode');
                document.getElementById('themeToggle').innerHTML = '<i class="fas fa-sun"></i>';
            }
        }
        
        saveSettings() {
            this.settings = {
                tgToken: document.getElementById('tgToken').value,
                tgChatId: document.getElementById('tgChatId').value,
                autoSaveInterval: parseInt(document.getElementById('autoSaveInterval').value),
                notifSound: document.getElementById('notifSound').checked,
                notifDesktop: document.getElementById('notifDesktop').checked,
                theme: document.body.classList.contains('light-mode') ? 'light' : 'dark'
            };
            
            this.saveToLocalStorage();
            this.setupAutoSave();
            this.hideModal('settingsModal');
            this.showToast('Pengaturan berhasil disimpan', 'success');
        }
        
        // === CLOUD SYNC ===
        async pushToCloud() {
            const token = this.settings.tgToken;
            const chatId = this.settings.tgChatId;
            
            if (!token || !chatId) {
                this.showToast('Token dan Chat ID harus diisi di pengaturan', 'warning');
                this.showModal('settingsModal');
                return;
            }
            
            if (!this.isOnline) {
                this.showToast('Tidak ada koneksi internet', 'error');
                return;
            }
            
            const syncBtn = document.getElementById('syncBtn');
            const originalText = syncBtn.innerHTML;
            
            syncBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i><span>SYNCING...</span>';
            syncBtn.disabled = true;
            
            try {
                // Encrypt data before sending
                const dataToSend = {
                    version: '6.0',
                    timestamp: new Date().toISOString(),
                    count: this.database.length,
                    data: btoa(JSON.stringify(this.database))
                };
                
                const response = await fetch(`https://api.telegram.org/bot${token}/sendMessage`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        chat_id: chatId,
                        text: `SAIFUSKI_BACKUP_${Date.now()}\n\`\`\`json\n${JSON.stringify(dataToSend, null, 2)}\n\`\`\``,
                        parse_mode: 'Markdown'
                    })
                });
                
                if (!response.ok) throw new Error('Telegram API error');
                
                this.showToast('Data berhasil disinkronkan ke cloud', 'success');
                document.getElementById('syncStatus').innerHTML = '<span>CLOUD SYNCED</span>';
                
                // Save last sync timestamp
                localStorage.setItem('saifuski_last_sync', new Date().toISOString());
                
            } catch (error) {
                console.error('Sync error:', error);
                this.showToast('Gagal menyinkronkan data', 'error');
            } finally {
                syncBtn.innerHTML = originalText;
                syncBtn.disabled = false;
            }
        }
        
        // === UTILITIES ===
        updateClock() {
            const now = new Date();
            document.getElementById('clock').textContent = now.toLocaleTimeString('en-GB', { hour12: false });
            document.getElementById('date').textContent = now.toLocaleDateString('id-ID', { 
                weekday: 'long', 
                day: 'numeric', 
                month: 'long', 
                year: 'numeric' 
            }).toUpperCase();
        }
        
        updateWorldClocks() {
            const now = new Date();
            const utc = now.getTime() + (now.getTimezoneOffset() * 60000);
            
            document.getElementById('timeTokyo').textContent = new Date(utc + (9 * 3600000)).toLocaleTimeString('en-GB', { hour12: false }).slice(0, 5);
            document.getElementById('timeLondon').textContent = new Date(utc + (1 * 3600000)).toLocaleTimeString('en-GB', { hour12: false }).slice(0, 5);
            document.getElementById('timeNewYork').textContent = new Date(utc - (4 * 3600000)).toLocaleTimeString('en-GB', { hour12: false }).slice(0, 5);
            document.getElementById('timeDubai').textContent = new Date(utc + (4 * 3600000)).toLocaleTimeString('en-GB', { hour12: false }).slice(0, 5);
        }
        
        updateStats() {
            document.getElementById('totalNotes').textContent = this.database.length;
            
            const today = new Date().toDateString();
            const todayNotes = this.database.filter(note => 
                new Date(note.createdAt).toDateString() === today
            ).length;
            
            document.getElementById('todayNotes').textContent = todayNotes;
        }
        
        updateStorageStats() {
            const used = JSON.stringify(this.database).length;
            const max = 5 * 1024 * 1024; // 5MB
            const percent = Math.min((used / max) * 100, 100);
            
            document.getElementById('storageBar').style.width = `${percent}%`;
            document.getElementById('storageUsed').textContent = this.formatBytes(used);
            document.getElementById('storageTotal').textContent = '5 MB';
        }
        
        formatBytes(bytes, decimals = 2) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const dm = decimals < 0 ? 0 : decimals;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
        }
        
        getPriorityBadge(priority) {
            const badges = {
                low: '<span class="badge badge-success">Rendah</span>',
                medium: '<span class="badge badge-warning">Sedang</span>',
                high: '<span class="badge badge-danger">Tinggi</span>'
            };
            return badges[priority] || '';
        }
        
        escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // === UI CONTROLS ===
        showToast(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.innerHTML = `
                <div class="toast-icon">
                    <i class="fas fa-${type === 'success' ? 'check' : type === 'error' ? 'exclamation' : type === 'warning' ? 'exclamation-triangle' : 'info'}"></i>
                </div>
                <div class="toast-content">
                    <div class="toast-title">${type.charAt(0).toUpperCase() + type.slice(1)}</div>
                    <div class="toast-message">${message}</div>
                </div>
                <button class="toast-close" onclick="this.parentElement.remove()">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            container.appendChild(toast);
            
            // Trigger animation
            setTimeout(() => toast.classList.add('show'), 10);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                if (toast.parentElement) {
                    toast.classList.remove('show');
                    setTimeout(() => toast.remove(), 300);
                }
            }, 5000);
            
            // Play sound if enabled
            if (this.settings.notifSound !== false) {
                this.playNotificationSound(type);
            }
        }
        
        playNotificationSound(type) {
            // Simple Web Audio API implementation
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = type === 'success' ? 800 : type === 'error' ? 400 : 600;
                gainNode.gain.value = 0.1;
                
                oscillator.start();
                setTimeout(() => oscillator.stop(), 200);
            } catch (e) {
                // Fallback to no sound
            }
        }
        
        showModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }
        
        hideModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }
        
        hideAllModals() {
            document.querySelectorAll('.modal-overlay').forEach(modal => {
                modal.classList.remove('active');
            });
        }
        
        resetForm() {
            document.getElementById('noteTitle').value = '';
            document.getElementById('noteDescription').value = '';
            document.getElementById('noteImgUrl').value = '';
            document.getElementById('noteCategory').value = 'UMUM';
            this.currentPriority = 'medium';
        }
        
        setPriority(priority) {
            this.currentPriority = priority;
            const buttons = document.querySelectorAll('[onclick^="setPriority"]');
            buttons.forEach(btn => btn.classList.remove('btn', 'btn-secondary'));
            
            buttons.forEach(btn => {
                if (btn.onclick.toString().includes(priority)) {
                    btn.classList.add('btn');
                } else {
                    btn.classList.add('btn-secondary');
                }
            });
        }
        
        // === ADVANCED FEATURES ===
        setupAutoSave() {
            if (this.autoSaveInterval) {
                clearInterval(this.autoSaveInterval);
            }
            
            const interval = parseInt(this.settings.autoSaveInterval || 10);
            if (interval > 0) {
                this.autoSaveInterval = setInterval(() => {
                    this.saveToLocalStorage();
                    this.showToast('Auto-save berhasil', 'info');
                }, interval * 60 * 1000);
            }
        }
        
        exportData() {
            const dataStr = JSON.stringify(this.database, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `saifuski-backup-${new Date().toISOString().slice(0,10)}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            this.showToast('Data berhasil diekspor', 'success');
        }
        
        clearLocalData() {
            if (confirm('Apakah Anda yakin ingin menghapus semua data lokal? Tindakan ini tidak dapat dibatalkan.')) {
                localStorage.clear();
                this.database = [];
                this.renderNotes();
                this.updateStats();
                this.showToast('Data lokal berhasil dihapus', 'success');
            }
        }
        
        handleOnlineStatus(online) {
            this.isOnline = online;
            const statusEl = document.getElementById('syncStatus');
            
            if (online) {
                statusEl.innerHTML = '<span>CLOUD ACTIVE</span>';
                statusEl.style.color = 'var(--accent-success)';
                this.showToast('Koneksi internet pulih', 'success');
            } else {
                statusEl.innerHTML = '<span>OFFLINE MODE</span>';
                statusEl.style.color = 'var(--accent-danger)';
                this.showToast('Bekerja dalam mode offline', 'warning');
            }
        }
        
        async migrateOldData() {
            // Check for old data format and migrate if needed
            const oldData = localStorage.getItem('saifuski_data');
            if (oldData) {
                try {
                    const parsed = JSON.parse(oldData);
                    if (Array.isArray(parsed)) {
                        this.database = parsed.map(item => ({
                            ...item,
                            id: item.id || Date.now().toString(36),
                            createdAt: item.createdAt || new Date().toISOString()
                        }));
                        this.saveToLocalStorage();
                        localStorage.removeItem('saifuski_data');
                        this.showToast('Data lama berhasil dimigrasi', 'success');
                    }
                } catch (e) {
                    console.error('Migration error:', e);
                }
            }
        }
        
        shareNote(index) {
            const note = this.database[index];
            const text = `${note.title}\n\n${note.description || ''}\n\nDibuat: ${new Date(note.createdAt).toLocaleDateString('id-ID')}`;
            
            if (navigator.share) {
                navigator.share({
                    title: note.title,
                    text: text,
                    url: window.location.href
                });
            } else {
                // Fallback to clipboard
                navigator.clipboard.writeText(text).then(() => {
                    this.showToast('Catatan disalin ke clipboard', 'success');
                });
            }
        }
    }

    // === GLOBAL INSTANCE & FUNCTIONS ===
    let system;

    window.onload = () => {
        system = new SaifuskiSystem();
        
        // Initialize calculator
        const calcDisplay = document.getElementById('calcDisplay');
        window.appendCalc = (value) => {
            calcDisplay.value = calcDisplay.value === '0' ? value : calcDisplay.value + value;
        };
        
        window.clearCalc = () => {
            calcDisplay.value = '0';
        };
        
        window.execCalc = () => {
            try {
                calcDisplay.value = eval(calcDisplay.value.replace('×', '*').replace('÷', '/'));
            } catch {
                calcDisplay.value = 'ERROR';
                setTimeout(() => calcDisplay.value = '0', 1000);
            }
        };
        
        // File upload handler
        document.getElementById('fileUpload').addEventListener('change', (e) => system.handleFileUpload(e));
        
        // Theme toggle
        document.getElementById('themeToggle').addEventListener('click', () => {
            document.body.classList.toggle('light-mode');
            const icon = document.querySelector('#themeToggle i');
            if (document.body.classList.contains('light-mode')) {
                icon.className = 'fas fa-sun';
                localStorage.setItem('saifuski_theme', 'light');
            } else {
                icon.className = 'fas fa-moon';
                localStorage.setItem('saifuski_theme', 'dark');
            }
        });
        
        // Apply saved theme
        const savedTheme = localStorage.getItem('saifuski_theme');
        if (savedTheme === 'light') {
            document.body.classList.add('light-mode');
            document.querySelector('#themeToggle i').className = 'fas fa-sun';
        }
        
        // PWA installation
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            
            // Show install button
            const installBtn = document.createElement('button');
            installBtn.className = 'btn';
            installBtn.innerHTML = '<i class="fas fa-download"></i> INSTALL APP';
            installBtn.style.marginTop = '10px';
            installBtn.onclick = () => {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then(() => {
                    deferredPrompt = null;
                });
            };
            
            document.querySelector('.system-status').appendChild(installBtn);
        });
    };

    // === GLOBAL HELPER FUNCTIONS ===
    window.showSettingsModal = () => system.showModal('settingsModal');
    window.hideModal = (id) => system.hideModal(id);
    window.saveSettings = () => system.saveSettings();
    window.startCamera = () => system.startCamera();
    window.takePhoto = () => system.takePhoto();
    window.uploadFile = () => system.uploadFile();
    window.addNote = () => system.addNote();
    window.setPriority = (p) => system.setPriority(p);
    window.pushToCloud = () => system.pushToCloud();
    window.exportData = () => system.exportData();
    window.clearLocalData = () => system.clearLocalData();
    window.searchNotes = () => system.searchNotes();
    window.filterNotes = () => system.filterNotes();
    window.refreshSchedule = () => {
        system.showToast('Jadwal diperbarui', 'info');
    };
    window.showFilters = () => {
        system.showToast('Filter diterapkan', 'info');
    };
    
    // Calculator functions are already defined above
</script>

<!-- SERVICE WORKER FOR PWA -->
<script>
    if ('serviceWorker' in navigator) {
        const swCode = `
            self.addEventListener('install', (event) => {
                event.waitUntil(
                    caches.open('saifuski-v6').then((cache) => {
                        return cache.addAll([
                            '/',
                            '/index.html',
                            '/manifest.json'
                        ]);
                    })
                );
            });
            
            self.addEventListener('fetch', (event) => {
                event.respondWith(
                    caches.match(event.request).then((response) => {
                        return response || fetch(event.request);
                    })
                );
            });
        `;
        
        const blob = new Blob([swCode], { type: 'application/javascript' });
        const swUrl = URL.createObjectURL(blob);
        
        // Only register if not already registered
        navigator.serviceWorker.getRegistrations().then(registrations => {
            if (registrations.length === 0) {
                navigator.serviceWorker.register(swUrl);
            }
        });
    }
</script>

</body>
</html>
